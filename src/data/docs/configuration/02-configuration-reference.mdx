---
title: 'Configuration Reference'
slug: 'configuration-reference'
section: configuration
---

import Code from '@/components/code.astro';

Complete reference for all Haloy configuration options.

## Configuration Structure

The configuration file supports **two modes** of operation:

1.  **Single Deployment**: If no `targets` are defined, the root configuration acts as the single deployment target.
2.  **Multi-Target**: If `targets` are defined, the root configuration acts as the **Base/Default** configuration. Specific targets inherit these defaults and can override them.

### Single Deployment Example

<Code code={`
  name: "my-app"
  server: "haloy.yourserver.com"
  image:
    repository: "my-app"
    tag: "latest"
`} lang="yaml" />

### Multi-Target Example

<Code code={`
  name: "my-app"
  # Base settings inherited by all targets
  image:
    repository: "my-app"
    tag: "latest"

  targets:
    prod:
      server: "prod.server.com"
      replicas: 2
    staging:
      server: "staging.server.com"
      replicas: 1
`} lang="yaml" />

## Global Configuration

These options are **only** available at the top level of the configuration file.

| Key                  | Type   | Description                                                                                     |
| -------------------- | ------ | ----------------------------------------------------------------------------------------------- |
| `targets`            | object | Define multiple deployment targets (see [Multi-Server Deployments](/docs/multi-server-deployments)) |
| `images`             | map    | Define named images that can be referenced by targets                                           |
| `secret_providers`   | object | Configure secret providers (see [Secret Providers](/docs/secret-providers))                     |
| `global_pre_deploy`  | array  | Commands to run once before **any** deployment starts                                           |
| `global_post_deploy` | array  | Commands to run once after **all** deployments finish                                           |

## Target Configuration

These options define a deployment unit.

*   **At Root**: They serve as the default settings (or the single deployment configuration).
*   **Under `targets`**: They override the defaults for that specific target.

| Key                   | Type           | Required | Description                                                                                                 |
| --------------------- | -------------- | -------- | ----------------------------------------------------------------------------------------------------------- |
| `name`                | string         | **Yes**  | Unique application name (Required at root)                                                                  |
| `preset`              | string         | No       | Apply preset configuration (Options: database, service)                                                     |
| `protected`           | boolean        | No       | Exclude from `--all` deployments (default: false)                                                           |
| `naming_strategy`     | string         | No       | Container naming: "dynamic" (default) or "static"                                                           |
| `image`               | object         | No       | Docker image configuration (see [Image Configuration](/docs/image-configuration))                           |
| `server`              | string         | No       | Haloy server API URL                                                                                        |
| `api_token`           | object         | No       | API token configuration (see [Authentication](/docs/server-authentication))                                 |
| `deployment_strategy` | string         | No       | Deployment strategy: "rolling" (default) or "replace"                                                       |
| `domains`             | array          | No       | Domain configuration                                                                                        |
| `acme_email`          | string         | No       | Let's Encrypt email (required with domains)                                                                 |
| `replicas`            | integer        | No       | Number of container instances (default: 1)                                                                  |
| `port`                | string/integer | No       | Container port to expose (default: "8080"). The port your application listens on inside the container.      |
| `health_check_path`   | string         | No       | Health check endpoint (default: "/")                                                                        |
| `env`                 | array          | No       | Environment variables (see [Environment Variables](/docs/environment-variables))                            |
| `volumes`             | array          | No       | Volume mounts (see [Volumes](/docs/volumes))                                                                |
| `pre_deploy`          | array          | No       | Commands to run before deploy (per target)                                                                  |
| `post_deploy`         | array          | No       | Commands to run after deploy (per target)                                                                   |
| `network`             | string         | No       | Docker network for the container. (default: `haloy`)                                                        |

## Configuration File Discovery

Haloy automatically searches for configuration files in the current directory in this order:

1. `haloy.yaml`
2. `haloy.yml`
3. `haloy.json`
4. `haloy.toml`

**Specify a custom location:**

<Code code={`
  # Specific file
  haloy deploy --config /path/to/config.yaml

  # Directory (will search for config files inside)
  haloy deploy --config /path/to/directory
`} lang="bash" />

Most Haloy commands require a configuration file. See [Basic Configuration](/docs/basic-configuration) to get started.



## Presets

Apply sensible defaults for specific use cases using the `preset` option.

### Database Preset

Use `preset: "database"` for stateful database services. This automatically applies:

- `deployment_strategy: "replace"` (safer for databases)
- `naming_strategy: "static"` (predictable container names)
- `protected: true` (prevents accidental deployment)
- `image.history.strategy: "none"` (no rollback history)

<Code code={`
  postgres:
    preset: database
    image:
      repository: postgres
      tag: "18"
    volumes:
      - /data/postgres:/var/lib/postgresql/data
`} lang="yaml" />

### Service Preset

Use `preset: "service"` for stateful services that share similar requirements to databases (static naming, replace strategy) but do not need the strict safety of being `protected`. This automatically applies:

- `deployment_strategy: "replace"`
- `naming_strategy: "static"`
- `image.history.strategy: "none"`

<Code code={`
  redis:
    preset: service
    image:
      repository: "henrygd/beszel"
      tag: "latest"
`} lang="yaml" />

## Protected Targets

Prevent accidental deployment of critical services (like databases) by marking them as protected.

<Code code={`
  targets:
    postgres:
      protected: true
`} lang="yaml" />

- Skipped by default when using `haloy deploy --all`
- Deploy explicitly: `haloy deploy -t postgres`
- Force inclusion: `haloy deploy --all --include-protected`

## Naming Strategy

Control how container names are generated.

| Strategy | Description | Example |
| -------- | ----------- | ------- |
| `dynamic` (default) | Includes deployment ID | `myapp-abc123` |
| `static` | Uses app name only | `myapp` |

**Constraints for Static Naming:**
- Requires `deployment_strategy: "replace"`
- Does not support multiple replicas

<Code code={`
  name: postgres
  naming_strategy: static
  deployment_strategy: replace
`} lang="yaml" />

## Deployment Strategies

### Rolling Deployment (Default)

Gradually replaces old containers with new ones, ensuring zero downtime:

<Code code={`
  name: "my-app"
  deployment_strategy: "rolling"
  replicas: 3
`} lang="yaml" />

### Replace Deployment

Stops all old containers before starting new ones:

<Code code={`
  name: "my-app"
  deployment_strategy: "replace"
  replicas: 3
`} lang="yaml" />

## Deployment Hooks

**Important**: All deployment hooks (`pre_deploy`, `post_deploy`, `global_pre_deploy`, and `global_post_deploy`) are executed by the `haloy` CLI tool on the machine where you run the deployment command, **not on the server**. This means:

- Hooks run in your local environment with access to your local filesystem, environment variables, and installed tools
- They do not have direct access to the server's filesystem or environment
- Use hooks for local preparation tasks like building assets, running tests, or sending notifications
- For server-side operations, consider using container initialization scripts or application startup logic

Run custom commands before or after deployment:

<Code code={`
  name: "my-app"
  pre_deploy:
    - "npm run migrate"
    - "echo 'Starting deployment'"
  post_deploy:
    - "curl -X POST https://status.example.com/notify"
    - "echo 'Deployment complete'"
`} lang="yaml" />

For multi-target deployments, use global hooks:

<Code code={`
  name: "my-app"
  global_pre_deploy:
    - "npm run build"
    - "docker build -t my-app ."
  global_post_deploy:
    - "echo 'All deployments complete'"
  targets:
    production:
      server: prod.haloy.com
      pre_deploy:
        - "npm run test:production"
    staging:
      server: staging.haloy.com
      pre_deploy: - "npm run test:staging"
`} lang="yaml" />

## Multi-Target Overrides

When using multi-target deployments, each target can override base configuration:

| Key                 | Type    | Description                                          |
| ------------------- | ------- | ---------------------------------------------------- |
| `server`            | string  | Override the server for this target                  |
| `api_token`         | object  | Override the API token configuration                 |
| `image`             | object  | Override image configuration (repository, tag, etc.) |
| `domains`           | array   | Override domain configuration                        |
| `acme_email`        | string  | Override ACME email                                  |
| `env`               | array   | Override environment variables                       |
| `replicas`          | integer | Override number of replicas                          |
| `preset`            | string  | Override preset                                      |
| `protected`         | boolean | Override protected status                            |
| `naming_strategy`   | string  | Override naming strategy                             |
| `deployment_strategy`| string | Override deployment strategy                         |
| `port`              | string  | Override container port                              |
| `health_check_path` | string  | Override health check path                           |
| `volumes`           | array   | Override volume mounts                               |
| `pre_deploy`        | array   | Override pre-deploy hooks                            |
| `post_deploy`       | array   | Override post-deploy hooks                           |
| `network`           | string  | Override docker network                              |

**Inheritance Rules:**

- Base configuration provides defaults for all targets
- Most target-specific values completely override base values (no merging)
- Only specified fields in targets override the base
- **Exception:** Environment variables (`env`) are merged - target values override base values with the same name, while preserving other base variables
- `global_pre_deploy` and `global_post_deploy` run once regardless of targets

### Example

<Code code={`
  # Base configuration - inherited by all targets
  name: "my-app"
  image:
    repository: "ghcr.io/my-org/my-app"
    tag: "latest"
  replicas: 2
  port: "8080"
  env:
    - name: "LOG_LEVEL"
      value: "info"
  # Targets
  targets:
    production: # Inherits: replicas=2, port="8080", base env (LOG_LEVEL) # Overrides: image.tag, adds domains, adds/overrides env variables
      server: "prod.haloy.com"
      image:
        tag: "v1.2.3"
      domains:
        - domain: "my-app.com"
      env: # Merges with base env
        - name: "NODE_ENV"
          value: "production"
        # LOG_LEVEL="info" is inherited from base
    staging: # Inherits: image (repository + tag), replicas=2, port="8080", base env # Overrides: server, changes replicas, adds domains, overrides LOG_LEVEL
      server: "staging.haloy.com"
      replicas: 1
      domains:
        - domain: "staging.my-app.com"
      env:
        - name: "LOG_LEVEL"
          value: "debug"
        # FEATURE_FLAG is inherited from base
`} lang="yaml" />

## Custom Docker Network

By default, containers are attached to the `haloy` network. You can override this:

<Code code={`
  name: "my-app"
  network: "my-custom-network"
`} lang="yaml" />

**Important**: If you override the default network (`haloy`), the Haloy proxy will not be able to discover your containers. This means:

- Your application containers will not be included in the HAProxy configuration
- Traffic will not be routed to your application
- Your domains will not work, even though the containers are running
- The containers will be completely ignored by the routing system after they start

Only change the network if you have a specific networking requirement and understand that you'll need to handle routing separately.

## Validation

Validate your configuration file:

<Code code={`
  haloy validate-config
  haloy validate-config --config path/to/config.yaml
  haloy validate-config --show-resolved-config  # Display with secrets (use with caution)
`} lang="bash" />

## Next Steps

- [Environment Variables](/docs/environment-variables)
- [Volume Configuration](/docs/volumes)
- [Image Configuration](/docs/image-configuration)
- [Secret Providers](/docs/secret-providers)
