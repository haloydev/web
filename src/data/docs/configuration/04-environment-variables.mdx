---
title: 'Environment Variables'
slug: 'environment-variables'
section: configuration
description: 'Set environment variables for your Haloy deployments using inline values, secret references, or variable interpolation.'
---

import Code from '@/components/code.astro';

Configure environment variables for your deployed applications using multiple methods.

## Plain Text Values

The simplest way to set environment variables:

<Code code={`
  name: "my-app"
  env:
    - name: "DATABASE_URL"
      value: "postgres://localhost:5432/myapp"
    - name: "DEBUG"
      value: "true"
    - name: "MAX_CONNECTIONS"
      value: "100"
`} lang="yaml" />

## From Environment Variables

Reference environment variables from your local machine:

<Code code={`
  name: "my-app"
  env:
    - name: "DATABASE_URL"
      from:
        env: "PRODUCTION_DATABASE_URL"
    - name: "API_KEY"
      from:
        env: "MY_API_KEY"
    - name: "SECRET_KEY"
      from:
        env: "APP_SECRET"
`} lang="yaml" />

Set these in your shell before deploying:

<Code code={`
  export PRODUCTION_DATABASE_URL="postgres://prod-db:5432/myapp"
  export MY_API_KEY="your-api-key-here"
  export APP_SECRET="your-secret-here"
  haloy deploy
`} lang="bash" />

**Tip:** You have the option to define environment variables in files which the `haloy` CLI tool will automatically load. See [Environment Files](#environment-files) for more details.

## From Secret Providers

Use external secret management services like 1Password:

<Code code={`
  name: "my-app"
  secret_providers:
    onepassword:
      production-db:
        vault: "Production"
        item: "Database Credentials"
      api-keys:
        vault: "API Services"
        item: "Third-party APIs"
  env:
    - name: "DATABASE_PASSWORD"
      from:
        secret: "onepassword:production-db.password"
    - name: "API_SECRET"
      from:
        secret: "onepassword:api-keys.secret-key"
    - name: "STRIPE_KEY"
      from:
        secret: "onepassword:api-keys.stripe-key"
`} lang="yaml" />

See [Secret Providers](/docs/secret-providers) for more details.

## Environment Files

Haloy automatically loads environment variables from these files (in order):

1. `.env` in the current directory
2. `.env.local` in the current directory (overrides `.env`)
3. `.env.{target}` for target-specific variables
4. `.env` in the Haloy config directory (`~/.config/haloy/`)

### Example .env File

<Code code={`
  DATABASE_URL=postgres://localhost:5432/myapp
  API_KEY=your-secret-api-key
  DEBUG=true
  MAX_CONNECTIONS=100
`} lang="bash" />

### Local Overrides with .env.local

The `.env.local` file is loaded after `.env` and overrides any duplicate variables. This follows a common convention where:

- `.env` contains committed defaults and safe-to-share values
- `.env.local` contains local or secret overrides that are gitignored

**.env (committed to repository):**

<Code code={`
  DATABASE_URL=postgres://localhost:5432/myapp
  API_KEY=placeholder
  DEBUG=true
`} lang="bash" />

**.env.local (gitignored, local overrides):**

<Code code={`
  API_KEY=your-actual-secret-key
  DEBUG=false
`} lang="bash" />

In this example, `API_KEY` and `DEBUG` from `.env.local` override the values in `.env`, while `DATABASE_URL` remains unchanged.

### Target-Specific .env Files

For multi-target deployments:

**.env.production:**

<Code code={`
  DATABASE_URL=postgres://prod-db:5432/myapp
  DEBUG=false
  NODE_ENV=production
`} lang="bash" />

**.env.staging:**

<Code code={`
  DATABASE_URL=postgres://staging-db:5432/myapp
  DEBUG=true
  NODE_ENV=staging
`} lang="bash" />

## Mixed Approaches

Combine different methods in a single configuration:

<Code code={`
  name: "my-app"
  env:
    # Plain text for non-sensitive values
    - name: "PORT"
      value: "8080"
    - name: "LOG_LEVEL"
      value: "info"

    # From environment variables
    - name: "DATABASE_URL"
      from:
        env: "PRODUCTION_DATABASE_URL"

    # From secret providers
    - name: "API_SECRET"
      from:
        secret: "onepassword:api-keys.secret"
`} lang="yaml" />

## Env Var Interpolation

Reference other env vars within `value:` strings using `${VAR_NAME}` syntax to compose values from multiple sources.

<Code code={`
  env:
    - name: "DB_PASSWORD"
      from:
        secret: "onepassword:db-creds.password"
    - name: "DATABASE_URL"
      value: "postgres://admin:\${DB_PASSWORD}@db:5432/myapp"
`} lang="yaml" />

Variables are resolved after secrets are fetched, and declaration order does not matter.

### Syntax

- Only `${VAR_NAME}` is supported (bare `$VAR` is not recognized)
- Variable names must match `[A-Za-z_][A-Za-z0-9_]*`
- Only applies to `value:` strings, not `from:` sourced values

### Multiple and Chained References

You can reference multiple variables in a single value, and reference variables that themselves use interpolation:

<Code code={`
  env:
    - name: "SERVICE_HOST"
      value: "api.example.com"
    - name: "SERVICE_PORT"
      value: "443"
    - name: "SERVICE_BASE"
      value: "https://\${SERVICE_HOST}:\${SERVICE_PORT}"
    - name: "SERVICE_ENDPOINT"
      value: "\${SERVICE_BASE}/v2/data"
`} lang="yaml" />

### Undefined and Circular References

- Undefined references are left as literal text. This is backwards compatible with `${...}` patterns meant for runtime resolution inside the container.
- Circular dependencies produce an error during `haloy deploy` and `haloy validate-config`.

Use `haloy validate-config --show-resolved-config` to verify interpolated values resolve correctly.

## Build Arguments from Environment Variables
When building Docker images locally, you often need the same variable both as a runtime environment variable and as a build argument. Instead of duplicating the definition, use the `build_arg` option:

<Code code={`
  name: "my-app"
  env:
    - name: "NODE_ENV"
      value: "production"
      build_arg: true  # Also pass as build argument
    - name: "API_URL"
      from:
        env: "API_URL"
      build_arg: true
  image:
    repository: "my-app"
    build_config:
      context: "."
`} lang="yaml" />

This is equivalent to the more verbose:

<Code code={`
  env:
    - name: "NODE_ENV"
      value: "production"
    - name: "API_URL"
      from:
        env: "API_URL"
  image:
    repository: "my-app"
    build_config:
      context: "."
      args:
        - name: "NODE_ENV"
          value: "production"
        - name: "API_URL"
          from:
            env: "API_URL"
`} lang="yaml" />

**Notes:**
- The `build_arg` option only takes effect when the image has a `build_config` (i.e., the image will be built locally)
- If the same variable name is explicitly defined in `build_config.args`, the explicit definition takes precedence
- All value sources work with `build_arg`: plain `value`, `from.env`, and `from.secret`

## Multi-Target Environment Variables

Merge environment variables per target:

<Code code={`
  name: "my-app"
  # Base environment variables
  env:
    - name: "LOG_LEVEL"
      value: "info"
    - name: "FEATURE_FLAG"
      value: "false"
  targets:
    production:
      env:  # Merges with base env
        - name: "NODE_ENV"
          value: "production"
        - name: "LOG_LEVEL"
          value: "warn"  # Overrides base LOG_LEVEL
        - name: "DATABASE_URL"
          from:
            secret: "onepassword:prod-db.url"
      # Result: NODE_ENV=production, LOG_LEVEL=warn, FEATURE_FLAG=false, DATABASE_URL=<from secret>
    staging:
      env:  # Merges with base env
        - name: "NODE_ENV"
          value: "staging"
        - name: "LOG_LEVEL"
          value: "debug"  # Overrides base LOG_LEVEL
        - name: "DATABASE_URL"
          from:
            env: "STAGING_DATABASE_URL"
      # Result: NODE_ENV=staging, LOG_LEVEL=debug, FEATURE_FLAG=false, DATABASE_URL=<from env>
`} lang="yaml" />

**Note:** Environment variables defined in targets are merged with base environment variables. Target-specific values override base values with the same name, while other base values are preserved.

## Best Practices

1. **Never commit secrets**: Use `.env` files or secret providers for sensitive data
2. **Add .env files to .gitignore**: Prevent accidental commits

<Code code={`
  echo ".env" >> .gitignore
  echo ".env.local" >> .gitignore
  echo ".env.*" >> .gitignore
`} lang="bash" />

3. **Use secret providers for production**: More secure than plain text or environment variables
4. **Document required variables**: Keep a `.env.example` file:

<Code code={`
  DATABASE_URL=postgres://localhost:5432/myapp
  API_KEY=your-api-key-here
  SECRET_KEY=your-secret-here
`} lang="bash" />

5. **Validate configuration**: Use `haloy validate-config` to check your setup

## Viewing Resolved Configuration

To see the final configuration with all secrets resolved (use with caution):

<Code code={`haloy validate-config --show-resolved-config`} lang="bash" />

> **Warning:** This will display all secrets in plain text. Only use in secure environments.

## Next Steps

- [Configure Secret Providers](/docs/secret-providers)
- [Set up Volume Mounts](/docs/volumes)
- [Learn about Multi-Server Deployments](/docs/multi-server-deployments)
