---
title: 'Server Installation'
slug: 'server-installation'
section: getting-started
---

import Code from '@/components/code.astro';

The Haloy daemon (`haloyd`) runs on your server and manages container deployments, service discovery, and traffic routing.

## Prerequisites

- Linux server (Debian/Ubuntu, RHEL/CentOS, Alpine, or other distributions)
- Docker installed and running
- Root or sudo access
- A domain or subdomain pointing to your server (for HTTPS API access)

## Quick Install

SSH into your server and run the install script:

<Code code="curl -fsSL https://sh.haloy.dev/install-haloyd.sh | sudo sh" lang="bash" />

The installer will:
1. Detect your init system (systemd, OpenRC, or SysVinit)
2. Create a dedicated `haloy` system user
3. Download and install the `haloyd` binary
4. Run `haloyd init` to set up configuration
5. Install and start the service
6. Display the API token for your local machine

### Environment Variables

You can configure the installation with environment variables:

<Code code={`
# Skip interactive prompts
curl -fsSL https://sh.haloy.dev/install-haloyd.sh | sudo \\
  API_DOMAIN=haloy.yourserver.com \\
  ACME_EMAIL=you@example.com \\
  sh

# Install specific version
curl -fsSL https://sh.haloy.dev/install-haloyd.sh | sudo VERSION=1.0.0 sh

# Install without starting the service
curl -fsSL https://sh.haloy.dev/install-haloyd.sh | sudo SKIP_START=1 sh
`} lang="bash" />

## Add Server to Local Machine

After installation, copy the API token from the output and add the server to your local haloy CLI:

<Code code="haloy server add haloy.yourserver.com <token>" lang="bash" />

You can retrieve the API token later by running on the server:

<Code code="sudo haloyd config get api-token" lang="bash" />

## Manual Installation

If you prefer to install manually or the script doesn't work for your system:

### 1. Install haloyd Binary

Download and install the binary:

<Code code={`
# Download latest release (adjust architecture as needed: amd64, arm64)
curl -fsSL -o /usr/local/bin/haloyd https://releases.haloy.dev/haloyd-linux-amd64
chmod +x /usr/local/bin/haloyd
`} lang="bash" />

### 2. Create System User

<Code code={`
# Create haloy user and add to docker group
useradd -r -s /bin/false haloy
usermod -aG docker haloy
`} lang="bash" />

### 3. Initialize haloyd

Run the init command to create configuration and directories:

<Code code="sudo haloyd init --api-domain haloy.yourserver.com --acme-email you@example.com" lang="bash" />

This creates:
- `/etc/haloy/haloyd.yaml` - Daemon configuration
- `/etc/haloy/.env` - API token
- `/var/lib/haloy/` - Data directory
- `haloy` Docker network

### 4. Install Service

#### Systemd

<Code code={`
cat > /etc/systemd/system/haloyd.service << 'EOF'
[Unit]
Description=Haloy Daemon
After=network-online.target docker.service
Wants=network-online.target
Requires=docker.service

[Service]
Type=simple
User=haloy
Group=haloy
ExecStart=/usr/local/bin/haloyd serve
Restart=always
RestartSec=5

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectHome=true
ProtectSystem=strict
ReadWritePaths=/var/lib/haloy /etc/haloy
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_BIND_SERVICE

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable --now haloyd
`} lang="bash" />

#### OpenRC

<Code code={`
cat > /etc/init.d/haloyd << 'EOF'
#!/sbin/openrc-run

name="haloyd"
description="Haloy Daemon"
command="/usr/local/bin/haloyd"
command_args="serve"
command_user="haloy:haloy"
pidfile="/run/haloyd.pid"
command_background=true

depend() {
    need net docker
    after firewall
}
EOF

chmod +x /etc/init.d/haloyd
rc-update add haloyd default
rc-service haloyd start
`} lang="bash" />

## Service Management

### Systemd

<Code code={`
# Start the service
sudo systemctl start haloyd

# Stop the service
sudo systemctl stop haloyd

# Restart the service
sudo systemctl restart haloyd

# Check service status
sudo systemctl status haloyd

# View logs
sudo journalctl -u haloyd -f
`} lang="bash" />

### OpenRC

<Code code={`
# Start the service
sudo rc-service haloyd start

# Stop the service
sudo rc-service haloyd stop

# Restart the service
sudo rc-service haloyd restart

# Check service status
sudo rc-service haloyd status
`} lang="bash" />

## Configuration

The haloyd configuration file is located at `/etc/haloy/haloyd.yaml`:

<Code code={`
api_domain: haloy.yourserver.com
acme_email: you@example.com
health_monitor:
  enabled: true
  interval: "15s"
  fall: 3
  rise: 2
  timeout: "5s"
`} lang="yaml" />

### View or Update Configuration

<Code code={`
# View a configuration value
sudo haloyd config get api-domain

# Set a configuration value
sudo haloyd config set api-domain haloy.newdomain.com

# Get the API token
sudo haloyd config get api-token
`} lang="bash" />

## Directory Structure

<Code code={`
/etc/haloy/              # Configuration
├── haloyd.yaml          # Daemon settings
└── .env                 # API token

/var/lib/haloy/          # Data
├── certs/               # SSL certificates
└── db/                  # Deployment database
`} lang="bash" />

## Verify Installation

Run the verify command to check that everything is working:

<Code code="sudo haloyd verify" lang="bash" />

This checks:
- Configuration directory and files
- Data directory
- Docker connectivity
- Docker network
- API health

## Same-Server Deployment

If you want to run the `haloy` CLI directly on the server (instead of from your local machine), you can add the server using localhost:

<Code code="haloy server add localhost <api-token>" lang="bash" />

This is useful for:
- Single-server setups
- CI/CD pipelines running on the server
- Situations where external API access isn't available

## Troubleshooting

### Service Won't Start

Check the logs:

<Code code="sudo journalctl -u haloyd -n 50" lang="bash" />

Common issues:
- Docker not running: `sudo systemctl start docker`
- Port 80/443 in use: Check with `sudo ss -tlnp | grep -E ':80|:443'`
- Permission issues: Ensure the `haloy` user is in the `docker` group

### Cannot Connect to API

Verify the service is running and listening:

<Code code={`
# Check service status
sudo systemctl status haloyd

# Check if ports are open
sudo ss -tlnp | grep haloyd

# Test API locally
curl -k https://localhost/health
`} lang="bash" />

### Verify Docker Access

<Code code={`
# Test that haloy user can access Docker
sudo -u haloy docker ps
`} lang="bash" />

## Uninstalling

To completely remove Haloy from your server:

<Code code="curl -sL https://sh.haloy.dev/uninstall-server.sh | sudo sh" lang="bash" />

This will:
- Stop and remove the haloyd service
- Optionally back up your data
- Remove configuration and data directories
- Remove the haloyd binary
- Optionally remove the haloy user

See [Uninstalling](/docs/uninstalling) for more details.

## Next Steps

- [Add the server to your local machine](/docs/server-authentication)
- [View haloyd command reference](/docs/haloyd)
- [Deploy your first application](/docs/quickstart#3-create-haloyyaml)
