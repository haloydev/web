---
import type { MarkdownHeading } from 'astro';
import { Navbar } from '@/components/navbar';
import { DocsNavigation } from '@/components/docs-navigation';
import { DocsTableOfContents } from '@/components/docs-table-of-contents';
import BaseLayout from '@/layouts/base.astro';
import Prose from '@/components/prose.astro';
import { getCollection } from 'astro:content';

const categories = await getCollection('docCategories');
const categoriesWithPages = await Promise.all(
  categories.map(async (category) => {
    const pages = (await getCollection('docPages', ({ data }) => data.category.id === category.id)).sort((a, b) =>
      a.id.localeCompare(b.id),
    );
    return {
      ...category,
      pages,
    };
  }),
);

interface Props {
  title: string;
  activeSlug: string;
  headings: MarkdownHeading[];
}

const { title, activeSlug, headings } = Astro.props;
---

<BaseLayout title={`${title} - Haloy Documentation`}>
  <Navbar client:load />
  <div class="lg:flex">
    <DocsNavigation activeSlug={activeSlug} categoriesWithPages={categoriesWithPages} client:load />
    <main class="flex-1 lg:flex">
      <div class="flex-1 px-6 pb-20 lg:flex lg:justify-center">
        <Prose>
          <h1>{title}</h1>
          <slot />
        </Prose>
      </div>
      <div class="hidden w-72 lg:block">
        <DocsTableOfContents client:load headings={headings} />
      </div>
    </main>
  </div>
</BaseLayout>
